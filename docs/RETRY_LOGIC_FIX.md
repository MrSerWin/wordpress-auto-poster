# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞—Ç–µ–π —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∞–ª–∞ —É–ø–∏—Ä–∞—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã Gemini API –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. ‚è∞ –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞—Å—Ç—É–ø–∏–ª–æ (–ø—Ä–æ—à–ª–æ 3 –¥–Ω—è)
2. üî¥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å (API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É)
3. ‚ùå –°—Ç–∞—Ç—å—è –Ω–µ –±—ã–ª–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–∞—è
4. üîÑ **–ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç** —Å–∏—Å—Ç–µ–º–∞ —Å–Ω–æ–≤–∞ –≤–∏–¥–µ–ª–∞ "–≤—Ä–µ–º—è –Ω–∞—Å—Ç—É–ø–∏–ª–æ" ‚Üí —Å–Ω–æ–≤–∞ –ø—ã—Ç–∞–ª–∞—Å—å –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
5. üî¥ –û–ø—è—Ç—å –æ—à–∏–±–∫–∞ ‚Üí —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è **–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–≤–æ—Ç–∞ API –∏—Å—á–µ—Ä–ø—ã–≤–∞–ª–∞—Å—å –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤, —Ö–æ—Ç—è –º—ã –ø—É–±–ª–∏–∫—É–µ–º —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ 3 –¥–Ω—è.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º **–∑–∞–¥–µ—Ä–∂–∫–∏ (backoff)** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. **–ù–æ–≤–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞:**
   ```python
   RETRY_DELAY_MINUTES = 60  # –ü—Ä–∏ –æ—à–∏–±–∫–µ –∂–¥–µ–º 1 —á–∞—Å –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
   ```

2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫:**
   ```python
   last_failed_attempt = None  # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
   ```

3. **–õ–æ–≥–∏–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ `run_scheduler()`:**
   - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤—Ä–µ–º—è: `last_failed_attempt = current_time`
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç) —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –ø—Ä–æ—à–ª–æ –ª–∏ 60 –º–∏–Ω—É—Ç —Å –æ—à–∏–±–∫–∏?
   - –ï—Å–ª–∏ –ù–ï–¢ ‚Üí **–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–æ–ø—ã—Ç–∫—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏**, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Ä–µ–º—è –Ω–∞—Å—Ç—É–ø–∏–ª–æ
   - –ï—Å–ª–∏ –î–ê ‚Üí —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `last_failed_attempt = None` –∏ –ø—Ä–æ–±—É–µ—Ç —Å–Ω–æ–≤–∞

### –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

**–§–∞–π–ª:** [auto_publisher.py](auto_publisher.py)

**–°—Ç—Ä–æ–∫–∏ 36-39:** –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
```python
RETRY_DELAY_MINUTES = 60
last_failed_attempt = None
```

**–°—Ç—Ä–æ–∫–∏ 284-298:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏
```python
if last_failed_attempt:
    time_since_failure = current_time - last_failed_attempt
    minutes_since_failure = time_since_failure.total_seconds() / 60

    if minutes_since_failure < RETRY_DELAY_MINUTES:
        remaining = RETRY_DELAY_MINUTES - minutes_since_failure
        logger.info(f"‚è∏Ô∏è  –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏: –µ—â–µ {remaining:.0f} –º–∏–Ω—É—Ç –¥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏")
        should_publish = False  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º
    else:
        logger.info(f"‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—à–ª–∞, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞")
        last_failed_attempt = None
```

**–°—Ç—Ä–æ–∫–∏ 334-338:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—à–∏–±–∫–∏
```python
else:
    # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—Ä–µ–º—è –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
    last_failed_attempt = current_time
    logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é")
    logger.info(f"‚è∏Ô∏è  –°–ª–µ–¥—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ {RETRY_DELAY_MINUTES} –º–∏–Ω—É—Ç")
```

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü–æ–ø—ã—Ç–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ **–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç**
- ‚ùå –ö–≤–æ—Ç–∞ API –∏—Å—á–µ—Ä–ø—ã–≤–∞–ª–∞—Å—å –±—ã—Å—Ç—Ä–æ
- ‚ùå 12 –ø–æ–ø—ã—Ç–æ–∫ –≤ —á–∞—Å = **12 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ **—Ä–∞–∑ –≤ 60 –º–∏–Ω—É—Ç** –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –ö–≤–æ—Ç–∞ API —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è —ç–∫–æ–Ω–æ–º–Ω–æ
- ‚úÖ 1 –ø–æ–ø—ã—Ç–∫–∞ –≤ —á–∞—Å = **1 –∑–∞–ø—Ä–æ—Å –∫ API**

### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
- ‚úÖ –°—Ç–∞—Ç—å—è –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è
- ‚úÖ `last_failed_attempt` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –°–ª–µ–¥—É—é—â–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ **3 –¥–Ω—è** (–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)

## –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

### –ü—Ä–∏ –æ—à–∏–±–∫–µ (–ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞):
```
09:19:04 - ‚ùå FAILED: Article generation failed
09:19:05 - ‚ùå Article will NOT be published
09:19:05 - ‚è∏Ô∏è  –°–ª–µ–¥—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç
```

### –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤–æ –≤—Ä–µ–º—è –∑–∞–¥–µ—Ä–∂–∫–∏:
```
09:24:05 - üîç –ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞: 2025-11-10 17:19:04
09:24:05 - üîç –ü—Ä–æ—à–ª–æ –º–∏–Ω—É—Ç —Å –æ—à–∏–±–∫–∏: 5.0
09:24:05 - ‚è∏Ô∏è  –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏: –µ—â–µ 55 –º–∏–Ω—É—Ç –¥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
09:24:05 - üîç –†–µ—à–µ–Ω–∏–µ –æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: False
```

### –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏:
```
10:20:05 - üîç –ü—Ä–æ—à–ª–æ –º–∏–Ω—É—Ç —Å –æ—à–∏–±–∫–∏: 61.0
10:20:05 - ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—à–ª–∞, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
10:20:05 - üîç –†–µ—à–µ–Ω–∏–µ –æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: True
10:20:05 - üîç –ó–∞–ø—É—Å–∫–∞–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏—é —Å—Ç–∞—Ç—å–∏...
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –≤ —Å—Ç—Ä–æ–∫–µ 36:

```python
RETRY_DELAY_MINUTES = 60  # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- **30 –º–∏–Ω—É—Ç** - –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
- **60 –º–∏–Ω—É—Ç** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç–µ–∫—É—â–µ–µ)
- **120 –º–∏–Ω—É—Ç** - –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–≤–æ—Ç—ã API

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–∞–±–æ—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã:

```bash
# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
tail -f logs/auto_publisher.out

# –ò—Å–∫–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏
grep "–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏" logs/auto_publisher.out

# –ò—Å–∫–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
grep "‚úÖ –°—Ç–∞—Ç—å—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞" logs/auto_publisher.out
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ [auto_publisher.py](auto_publisher.py) - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
- ‚úÖ [FIXES_RU.md](FIXES_RU.md) - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ [CATEGORY_FIX.md](CATEGORY_FIX.md) - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## –ò—Ç–æ–≥

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞:
1. ‚úÖ –ù–ï —Å–ø–∞–º–∏—Ç API –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
2. ‚úÖ –ñ–¥–µ—Ç 60 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
3. ‚úÖ –≠–∫–æ–Ω–æ–º–∏—Ç –∫–≤–æ—Ç—É API
4. ‚úÖ –ü—É–±–ª–∏–∫—É–µ—Ç —Ä–∞–∑ –≤ 3 –¥–Ω—è (–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)

–ü—Ä–æ–±–ª–µ–º–∞ —Å –ª–∏–º–∏—Ç–∞–º–∏ API –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! üéâ
