#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä–∞ —Å—Ç–∞—Ç–µ–π

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç–µ–π..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä
if ! pgrep -f "auto_publisher.py" > /dev/null; then
    echo "‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º PID
PUBLISHER_PID=$(pgrep -f "auto_publisher.py")
echo "   –ù–∞–π–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å —Å PID: $PUBLISHER_PID"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
pkill -f "auto_publisher.py"

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
sleep 2

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
if pgrep -f "auto_publisher.py" > /dev/null; then
    echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º..."
    pkill -9 -f "auto_publisher.py"
    sleep 1
fi

# –£–¥–∞–ª—è–µ–º PID —Ñ–∞–π–ª
if [ -f "logs/auto_publisher.pid" ]; then
    rm logs/auto_publisher.pid
fi

echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
